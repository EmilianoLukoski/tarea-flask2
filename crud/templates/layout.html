<!DOCTYPE html>
<html lang="es" data-theme="light">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Control de Nodos</title>

  <!-- Tema claro por defecto -->
  <link id="theme-css" rel="stylesheet" href="https://bootswatch.com/5/sandstone/bootstrap.min.css" />

  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
  />

  <style>
    /* Estilos para la barra de navegación en modo claro */
    .navbar {
      background-color: #343a40 !important;
    }

    .nav-item {
      color: #f8f9fa !important;
    }

    /* Estilos para el tema oscuro de Sandstone */
    body.dark-theme {
      background-color: #212529;
      color: #f8f9fa;
    }

    body.dark-theme .navbar {
      background-color: #343a40 !important;
    }

    body.dark-theme .navbar-brand,
    body.dark-theme .nav-link {
      color: #f8f9fa !important;
    }

    body.dark-theme .card {
      background-color: #343a40;
      border-color: #212529;
      color: #f8f9fa;
    }

    body.dark-theme .card-title {
      color: #f8f9fa;
    }

    body.dark-theme .form-control {
      background-color: #212529;
      border-color: #495057;
      color: #f8f9fa;
    }

    body.dark-theme .form-control:focus {
      background-color: #212529;
      color: #f8f9fa;
      border-color: #6c757d;
      box-shadow: 0 0 0 0.25rem rgba(108, 117, 125, 0.25);
    }

    body.dark-theme .form-control::placeholder {
      color: #adb5bd;
    }

    body.dark-theme .btn-primary {
      background-color: #495057;
      border-color: #343a40;
      color: #f8f9fa;
    }

    body.dark-theme .btn-primary:hover {
      background-color: #343a40;
      border-color: #212529;
      color: #f8f9fa;
    }

    body.dark-theme .btn-danger {
      background-color: #dc3545;
      border-color: #dc3545;
      color: #f8f9fa;
    }

    body.dark-theme .btn-danger:hover {
      background-color: #bb2d3b;
      border-color: #b02a37;
      color: #f8f9fa;
    }

    body.dark-theme .btn-outline-light {
      color: #f8f9fa;
      border-color: #f8f9fa;
    }

    body.dark-theme .btn-outline-light:hover {
      background-color: #f8f9fa;
      color: #212529;
    }

    body.dark-theme .alert {
      background-color: #343a40;
      border-color: #212529;
      color: #f8f9fa;
    }

    body.dark-theme .alert-info {
      background-color: #495057;
      border-color: #343a40;
      color: #f8f9fa;
    }

    body.dark-theme .alert .btn-close {
      filter: invert(1) grayscale(100%) brightness(200%);
    }

    body.dark-theme a {
      color: #adb5bd;
    }

    body.dark-theme a:hover {
      color: #f8f9fa;
    }

    body.dark-theme .text-decoration-none {
      color: #adb5bd !important;
    }

    body.dark-theme .text-decoration-none:hover {
      color: #f8f9fa !important;
    }

    body.dark-theme .nav-item {
      color: #f8f9fa;
    }

    body.dark-theme .container {
      color: #f8f9fa;
    }

    body.dark-theme h1, 
    body.dark-theme h2, 
    body.dark-theme h3, 
    body.dark-theme h4, 
    body.dark-theme h5, 
    body.dark-theme h6 {
      color: #f8f9fa;
    }

    body.dark-theme .dropdown-menu {
      background-color: #343a40;
      border-color: #212529;
    }

    body.dark-theme .dropdown-item {
      color: #f8f9fa;
    }

    body.dark-theme .dropdown-item:hover {
      background-color: #495057;
      color: #f8f9fa;
    }

    body.dark-theme .dropdown-divider {
      border-color: #495057;
    }

    /* Estilos para los botones de control */
    .control-buttons {
      display: flex;
      gap: 1rem;
      margin-right: 1rem;
    }

    .btn-flash {
      background-color: #ffc107;
      border-color: #ffc107;
      color: #000;
    }

    .btn-flash:hover {
      background-color: #ffca2c;
      border-color: #ffc720;
      color: #000;
    }

    .btn-setpoint {
      background-color: #0dcaf0;
      border-color: #0dcaf0;
      color: #000;
    }

    .btn-setpoint:hover {
      background-color: #31d2f2;
      border-color: #25cff2;
      color: #000;
    }

    body.dark-theme .btn-flash {
      background-color: #ffc107;
      border-color: #ffc107;
      color: #000;
    }

    body.dark-theme .btn-flash:hover {
      background-color: #ffca2c;
      border-color: #ffc720;
      color: #000;
    }

    body.dark-theme .btn-setpoint {
      background-color: #0dcaf0;
      border-color: #0dcaf0;
      color: #000;
    }

    body.dark-theme .btn-setpoint:hover {
      background-color: #31d2f2;
      border-color: #25cff2;
      color: #000;
    }

    .flash-messages {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      max-width: 300px;
    }

    .flash-message {
      margin-bottom: 10px;
      animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .flash-message.fade-out {
      animation: fadeOut 0.5s ease-out forwards;
    }

    @keyframes fadeOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }

    body.dark-theme .alert-danger {
      background-color: #dc3545 !important;
      border-color: #dc3545 !important;
      color: #fff !important;
    }

    body.dark-theme .alert-danger:hover {
      background-color: #bb2d3b !important;
      border-color: #b02a37 !important;
    }

    body.dark-theme .light-theme-alert {
      display: none;
    }

    body.dark-theme .dark-theme-alert {
      display: block;
    }

    body:not(.dark-theme) .light-theme-alert {
      display: block;
    }

    body:not(.dark-theme) .dark-theme-alert {
      display: none;
    }

    /* Estilos para las notificaciones */
    .alert-success {
      background-color: #198754 !important;
      border-color: #198754 !important;
      color: #fff !important;
    }

    .alert-danger {
      background-color: #dc3545 !important;
      border-color: #dc3545 !important;
      color: #fff !important;
    }

    body.dark-theme .alert-success {
      background-color: #198754 !important;
      border-color: #198754 !important;
      color: #fff !important;
    }

    body.dark-theme .alert-danger {
      background-color: #dc3545 !important;
      border-color: #dc3545 !important;
      color: #fff !important;
    }

    .flash-message {
      animation: slideIn 0.5s ease-out;
    }

    .flash-message.fade-out {
      animation: fadeOut 0.5s ease-out forwards;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes fadeOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }
  </style>
</head>

<body>
  {% if get_flashed_messages() %}
  <div class="position-fixed top-0 end-0 p-3" style="z-index: 11">
    {% for category, message in get_flashed_messages(with_categories=true) %}
    <div class="alert alert-dismissible fade show flash-message {% if category == 'success' %}alert-success{% elif category == 'danger' %}alert-danger{% endif %}" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="{{ url_for('index') if session.get('user_id') else url_for('login') }}">Control de Nodos</a>
      <div class="d-flex align-items-center">
        <button id="theme-toggle" class="btn btn-outline-light me-3" title="Cambiar tema">
          <i class="bi bi-sun-fill"></i>
        </button>
        {% if session.get("user_id") %}
        <div class="nav-item pe-3 d-flex align-items-center">
          <i class="bi bi-person-circle me-2 fs-5"></i>
          <span class="fw-bold fs-5">{{ session.get("user_id") }}</span>
        </div>
        <a href="{{ url_for('logout') }}" class="btn btn-danger">Cerrar sesión</a>
        {% endif %}
      </div>
    </div>
  </nav>

  <div class="container pt-4">
    {% block body %}
    {% endblock %}
  </div>

  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
    crossorigin="anonymous"
  ></script>

  <script>
    // Variables globales para el tema
    window.USER_THEME = {% if tema_preferido is defined %}{{ tema_preferido }}{% else %}0{% endif %};
    window.IS_AUTHENTICATED = {% if session.get('user_id') %}true{% else %}false{% endif %};
    window.UPDATE_THEME_URL = "{{ url_for('actualizar_tema') }}";
  </script>
  
  <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
  <script>
    // Auto-cerrar los mensajes después de 3 segundos
    document.addEventListener('DOMContentLoaded', function() {
      const flashMessages = document.querySelectorAll('.flash-message');
      flashMessages.forEach(function(message) {
        setTimeout(function() {
          message.classList.add('fade-out');
          setTimeout(function() {
            message.remove();
          }, 500);
        }, 3000);
      });
    });
  </script>
</body>

</html>
